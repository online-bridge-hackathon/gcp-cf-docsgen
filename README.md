# gcp-cf-docsgen

[![JavaScript Style Guide](https://img.shields.io/badge/code_style-standard-brightgreen.svg)](https://standardjs.com)
[![Inline docs](https://inch-ci.org/github/online-bridge-hackathon/gcp-cf-docsgen.svg?branch=master)](https://inch-ci.org/github/online-bridge-hackathon/gcp-cf-docsgen)
[![NPM Version](https://img.shields.io/npm/v/npm.svg?style=flat)](https://www.npmjs.com/)
[![License](https://img.shields.io/npm/l/all-contributors.svg?style=flat)](https://github.com/online-bridge-hackathon/gcp-cf-docsgen/blob/master/LICENSE)
[![contributions welcome](https://img.shields.io/badge/contributions-welcome-brightgreen.svg?style=flat)](https://github.com/online-bridge-hackathon/gcp-cf-docsgen/issues) 

## [API Documentation Page](https://storage.cloud.google.com/gba-docs/index.html)

## Overview

GCP Cloud Function to generate and update documentation for the different projects of [Global Bridge App](https://github.com/online-bridge-hackathon/bridge-hackathon).

Triggered when a new/updated spec is uploaded to Global Bridge App's [gba-api bucket](https://storage.cloud.google.com/gba-api). Output documentation is uploaded to the [gba-docs bucket](https://storage.cloud.google.com/gba-docs).

A main HomePage is also rendered based on the specs currently active @gba-docs using a simple mustache template. See /templates/readme.html.md.mustache

Currently supports [OpenApi V3](https://www.openapis.org/) for REST APIs and [AsyncApi V2](https://www.asyncapi.com/) for Event Driven/Asynchronous APIs specifications.

* * *

## Current features

-   Renders a Main HomePage using [Widdershins](https://github.com/Mermade/widdershins#readme) based on the current uploaded specs @[gba-apis](https://storage.cloud.google.com/gba-apis)
-   Renders a slate/shin markdown page with code samples for each project using [Widdershins](https://github.com/Mermade/widdershins#readme) and [Shins](https://github.com/Mermade/shins#readme)
-   Renders an HTML page with code samples for each project using [Redoc](https://github.com/Redocly/redoc#readme) and [AsyncDoc](https://github.com/jfveronelli/instant-asyncapi-doc)
-   Auto links to a [Swagger](https://editor.swagger.io/)/[Asyncapi](https://playground.asyncapi.io/) playground with live "try-out"
-   [Postman](https://explore.postman.com/globalbridge-app) collections linkage

* * *

## CD

This project's master branch is hooked to gcp's [Cloud Build](https://cloud.google.com/cloud-build). 

Deploys onUpdate and onDelete entry points as cloud functions.

Coverage([nyc](https://www.npmjs.com/package/nyc)) thresholds are currently set to 100%.

See cloudbuild.yaml for specifics.

* * *

## Installation and Setup

### - REQUIREMENTS

* [NodeJS](https://nodejs.org/en/) (v12+)

### - ENVIRONMENT VARIABLES

The following environment variables *must* be set either at the cloud environment or using .env or something simillar. They are not required for testing purposes.

* API_BUCKET - gcp APIs bucket name

* DOCS_BUCKET - gcp DOCS output bucket name

The following environment variables *may* be set either at the cloud environment or using .env or something simillar. They are not required for testing purposes.

If ommited, the Postman collection will not be updated.

* POSTMAN_APIKEY - Postman API Key for updating collections. See https://explore.postman.com/globalbridge-app

### - PACKAGES

    npm install

* * *

## Tests

The accessible entry points(onUpload and onDelete) are tested against well formed and badly formed spec inputs.

    npm run test
    npm run coverage

* * *

## Docs

Generate docs for the [#Code-Documentation](#Code-Documentation) section of this readme

    npm run docs

* * *

## License

[MIT](https://github.com/online-bridge-hackathon/gcp-cf-docsgen/blob/master/LICENSE)

* * *

# Code-Documentation

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [onUpload](#onupload)
    -   [Parameters](#parameters)
-   [onDelete](#ondelete)
    -   [Parameters](#parameters-1)

## onUpload

GCP Cloud Function onUpload.
Generates both the API documentation for a given spec (OpenApi-v3 or AsyncApi-v2) and the main page.

### Parameters

-   `file` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** [File object]{@ <https://googleapis.dev/nodejs/storage/latest/Bucket.html#file}> from GCP
-   `context` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `callback` **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** Callback signal to GCP

## onDelete

GCP Cloud Function onDelete.
Updates the main page.

### Parameters

-   `file` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** [File object]{@ <https://googleapis.dev/nodejs/storage/latest/Bucket.html#file}>
-   `context` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `callback` **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** Callback signal to GCP
