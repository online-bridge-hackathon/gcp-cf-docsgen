# gcp-cf-docsgen

[![JavaScript Style Guide](https://img.shields.io/badge/code_style-standard-brightgreen.svg)](https://standardjs.com)
[![Inline docs](https://inch-ci.org/github/online-bridge-hackathon/gcp-cf-docsgen.svg?branch=master)](https://inch-ci.org/github/online-bridge-hackathon/gcp-cf-docsgen)
[![NPM Version](https://img.shields.io/npm/v/npm.svg?style=flat)](<>)
[![License](https://img.shields.io/npm/l/all-contributors.svg?style=flat)](https://github.com/online-bridge-hackathon/gcp-cf-docsgen/blob/master/LICENSE)
[![contributions welcome](https://img.shields.io/badge/contributions-welcome-brightgreen.svg?style=flat)](https://github.com/online-bridge-hackathon/gcp-cf-docsgen/issues) 

## [API Documentation Page](https://storage.cloud.google.com/gba-docs/index.html)

## Overview

GCP Cloud Function to generate and update documentation for the different projects of [Global Bridge App](https://github.com/online-bridge-hackathon/bridge-hackathon).

Triggered when a new/updated spec is uploaded to Global Bridge App's [gba-api bucket](https://storage.cloud.google.com/gba-api). Output documentation is uploaded to the [gba-docs bucket](https://storage.cloud.google.com/gba-docs).

A main HomePage is also rendered based on the specs currently active @gba-docs using a simple mustache template. See /templates/readme.html.md.mustache

Currently supports [OpenApi V3](https://www.openapis.org/) for REST APIs and [AsyncApi V2](https://www.asyncapi.com/) for Event Driven/Asynchronous APIs specifications.

* * *

## Current features

-   Renders a Main HomePage based on the current uploaded spec @gba-docs
-   Renders a slate/shin markdown page with code samples for each project
-   Renders an HTML page with code samples for each project
-   Auto links to a swagger/asyncapi playground with live "try-out"
-   Postman collections linkage

* * *

## CD

This project's master branch is hooked to gcp's cloud build, getting deployed every time there's a push to master. See cloudbuild.yaml for specifics.

* * *

## Installation and Setup

### - REQUIREMENTS

    NodeJS (v12+)

### - PACKAGES

    npm install

* * *

## Tests

The accessible entry points(onUpload and onDelete) are tested against well formed and badly formed spec inputs, with 100% coverage.

    npm run test
    npm run coverage

* * *

## Docs

Generate docs for the [#Code-Documentation](#Code-Documentation) section of this readme

    npm run docs

* * *

## License

MIT

* * *

# Code-Documentation

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [onUpload](#onupload)
    -   [Parameters](#parameters)
-   [onDelete](#ondelete)
    -   [Parameters](#parameters-1)
-   [parseSpec](#parsespec)
    -   [Parameters](#parameters-2)
    -   [saveFile](#savefile)
        -   [Parameters](#parameters-3)
    -   [downloadFile](#downloadfile)
        -   [Parameters](#parameters-4)
    -   [downloadBucket](#downloadbucket)
    -   [deleteFiles](#deletefiles)
        -   [Parameters](#parameters-5)
-   [genDocs](#gendocs)
    -   [Parameters](#parameters-6)
-   [widdershins](#widdershins)
    -   [Parameters](#parameters-7)
-   [openapi2Snippet](#openapi2snippet)
    -   [Parameters](#parameters-8)
-   [shins](#shins)
    -   [Parameters](#parameters-9)
-   [openapi2postman](#openapi2postman)
    -   [Parameters](#parameters-10)
-   [genMain](#genmain)

## onUpload

GCP Cloud Function onUpload.
Generates both the API documentation for a given spec (OpenApi-v3 or AsyncApi-v2) and the main page.

### Parameters

-   `file` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** [File object]{@ <https://googleapis.dev/nodejs/storage/latest/Bucket.html#file}> from GCP
-   `context` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `callback` **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** Callback signal to GCP

## onDelete

GCP Cloud Function onDelete.
Deletes the corresponding docs for the spec being deleted and updates the main page.

### Parameters

-   `file` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** [File object]{@ <https://googleapis.dev/nodejs/storage/latest/Bucket.html#file}>
-   `context` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `callback` **[Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** Callback signal to GCP

## parseSpec

Parses and Validates an OpenApi v3 or AsyncApi v2 specification

### Parameters

-   `data` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** OpenApi v3 or AsyncApi v2

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)>** A validated spec

### saveFile

Saves/Uploads file to DOCS GCP Bucket - GCP Node SDK

#### Parameters

-   `fileObject` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `fileObject.filePath` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
    -   `fileObject.data` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### downloadFile

Downloads a file from API GCP Bucket - GCP Node SDK

#### Parameters

-   `filePath` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** File content

### downloadBucket

Downloads a file link object from API GCP Bucket - GCP Node SDK

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)>** GCP Bucket file-link-object array

### deleteFiles

Deletes the project directory in the DOCS GCP Bucket - GCP Node SDK

#### Parameters

-   `projectName` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

## genDocs

Generates API Docs for a given spec

### Parameters

-   `spec` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** A Validated Spec (OpenApi v3 or AsyncApi v2)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)>** Array of file objects in the form of {filePath, data}

## widdershins

Converts an API spec (OpenApi or AsyncApi) to Markdown

### Parameters

-   `spec` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** A Validated Spec (OpenApi v3 or AsyncApi v2)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Markdown convertion for a given spec

## openapi2Snippet

Enriches an OpenApi spec with code snippets

### Parameters

-   `openApi` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** An OpenApi v3 spec.

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** An OpenApi enriched spec

## shins

Converts a markdown string to slate format using shins

### Parameters

-   `markdownString` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** HTML Shins page

## openapi2postman

Converts an OpenApi Spec to a Postman v2 collection and updates/syncs within globalbridge-app team space

### Parameters

-   `spec` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

## genMain

Generates the main page

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)>** File object in the form of {filePath, data}
